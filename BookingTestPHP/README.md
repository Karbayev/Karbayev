Функция createOrder
Создает уникальный barcode для заказа.
Потом пытается забронировать заказ через стороннее API. Если API возвращает ошибку "barcode already exists", генерирует новый barcode и повторяет запрос. После успешного бронирования отправляет запрос на подтверждение.В случае успешного подтверждения сохраняет заказ в базе данных.

Функция generateBarcode
Генерирует уникальный 8-значный штрих-код для каждого заказа согласно пулу цифр, можно уменьшить или увеличить

Функция bookOrder
Отправляет запрос на бронирование в API со всеми данными заказа. Возвращает message или error от API, в зависимости от результата запроса.

Функция approveOrder
Отправляет подтверждение заказа в API по уникальному barcode заказа. Возвращает статус подтверждения от API.

Функция saveOrderToDatabase - конечно же сохраняет данные в БД :)
Сохраняет основные данные заказа в таблицу orders. Для каждого билета создаёт уникальный barcode и сохраняет информацию в таблицу order_tickets.

Функция getTicketTypeId
Возвращает ID типа билета из таблицы ticket_types по названию типа билета.

Функция mockApiRequest
Имитирует ответ API для тестирования (например, возвращает случайные значения, такие как "order successfully booked" или "barcode already exists").

БД
orders - основная таблица для хранения заказов
ticket_types - справочная таблица с доступными типами билетов
order_tickets - Таблица для хранения детальной информации о каждом билете с уникальным barcode

Пример как можно протестить работу скрипта
$ticket_details = [
    'adult' => ['price' => 1200, 'quantity' => 7],
    'kid' => ['price' => 741, 'quantity' => 2],
    'discount' => ['price' => 5000, 'quantity' => 1],
    'group' => ['price' => 4600, 'quantity' => 2]
];

createOrder(3, '2024-11-06 19:00:00', $ticket_details);

